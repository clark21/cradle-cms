<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="/admin">
                <i class="fas fa-home"></i> Admin
            </a>
        </li>
        {{#if relation.suggestion}}
            <li class="breadcrumb-item">
                <a href="/admin/system/object/{{relation.schema.name}}/search">
                    <i class="{{relation.schema.icon}}"></i> {{relation.schema.plural}}
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="/admin/system/object/{{relation.schema.name}}/update/{{key relation.schema.primary relation.data}}">
                    {{relation.suggestion}}
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="/admin/system/object/{{schema.name}}/search/{{relation.schema.name}}/{{key relation.schema.primary relation.data}}">
                    <i class="fas fa-{{schema.icon}}"></i> {{schema.plural}}
                </a>
            </li>
        {{else}}
            <li class="breadcrumb-item">
                <a href="/admin/system/object/{{schema.name}}/search">
                    <i class="fas fa-{{schema.icon}}"></i> {{schema.plural}}
                </a>
            </li>
        {{/if}}
        <li class="breadcrumb-item active" aria-current="page">
            <i class="fas fa-plus"></i> {{title}}
        </li>
    </ol>
</nav>

<div class="main-padding">
    <div class="relations-menu">
        <div class="row">
            <div class="col-sm">
                {{#each schema.relations}}
                    {{#when many '==' 1}}
                    <span class="relation">
                        <span class="font-weight-bold">{{singular}}:</span>
                        <span>
                            <a 
                                href="/admin/system/object/{{name}}/update/{{key primary ../item}}" 
                                target="_blank"
                            >
                                {{get_suggestion this ../item}}
                            </a>
                        </span>
                        &nbsp;
                    </span>
                    {{/when}}
                {{/each}}
            </div>
            <div class="col-sm text-right">
                {{#each schema.relations}}
                    {{#when many '==' 2}}
                    <span class="relation">
                        <span class="font-weight-bold">{{plural}}</span>
                        <span>
                            <a href="/admin/system/object/{{name}}/search/{{../schema.name}}/{{key primary ../item}}" target="_blank">
                                View All {{plural}}
                            </a>
                        </span>
                    </span>
                    {{/when}}
                {{/each}}
            </div>
        </div>
    </div>

    <hr />

    {{#if relation.suggestion}}
        <h3 class="main-title">
            <i class="{{relation.schema.icon}}"></i>
            {{relation.suggestion}}
        </h3>
    {{/if}}

    <form
        class="box"
        method="post"
        {{#if cdn_config}}
            data-do="cdn-upload"
            data-on="submit"
            data-progress="{{_ 'We are uploading your files. Please do not refresh page.'}}"
            data-complete="{{_ 'Upload Complete'}}"
            data-enctype="{{cdn_config.form.enctype}}"
            data-method="{{cdn_config.form.method}}"
            data-action="{{cdn_config.form.action}}"
            data-cdn="{{cdn_config.form.action}}"
            data-acl="{{cdn_config.inputs.acl}}"
            data-key="{{cdn_config.inputs.key}}"
            data-credential="{{cdn_config.inputs.X-Amz-Credential}}"
            data-algorythm="{{cdn_config.inputs.X-Amz-Algorithm}}"
            data-date="{{cdn_config.inputs.X-Amz-Date}}"
            data-policy="{{cdn_config.inputs.Policy}}"
            data-signature="{{cdn_config.inputs.X-Amz-Signature}}"
        {{/if}}
    >
        <div class="box-head box-success">
            <div class="box-title">
                <i class="fa fa-plus"></i> {{title}}
            </div>
        </div>
        <div class="box-body box-padding">
            {{#each schema.relations}}
                {{#in many '0,1'}}
                    <div class="form-group{{#has primary2 ../errors}} has-error{{/has}}">
                        <label class="control-label">{{singular}}</label>
                        <div>
                            <input
                                autocomplete="off"
                                class="form-control suggestion-label-{{name}}"
                                name="{{suggestion_name}}"
                                placeholder="Enter {{singular}}"
                                type="text"
                                value="{{key suggestion_name ../item}}"
                            />
                            <input
                                class="suggestion-value-{{name}}"
                                name="{{primary2}}"
                                type="hidden"
                                value="{{key primary2 ../item}}"
                            />
                            <div
                                class="input-suggestion d-none"
                                data-do="suggestion-field"
                                data-format="{{suggestion}}"
                                data-target-label="input.suggestion-label-{{name}}"
                                data-target-value="input.suggestion-value-{{name}}"
                                {{#in name ../valid_relations}}
                                    data-url="/admin/system/object/{{name}}/search?q={QUERY}&render=false"
                                {{else}}
                                    data-url="/admin/{{name}}/search?q={QUERY}&render=false"
                                {{/in}}
                                data-value="{{primary2}}"
                            ></div>
                            {{#has primary2 ../errors}}
                                <span class="help-text">{{key primary2 ../errors}}</span>
                            {{/has}}
                        </div>
                    </div>
                {{/in}}
            {{/each}}
            {{#each schema.fields}}
                {{#in field.type 'none,hide,active,created,updated'}}
                {{else}}
                    <div class="form-group{{#has @key ../errors}} has-error{{/has}}">
                        <label class="control-label">{{label}}</label>
                        <div>
                            {{> object_fields}}
                            {{#has @key ../errors}}
                                <span class="help-text">{{key @key ../errors}}</span>
                            {{/has}}
                        </div>
                    </div>
                {{/in}}
            {{/each}}
        </div>
        <div class="box-foot box-light">
            <div class="box-left">
                <input type="hidden" name="csrf" value="{{csrf}}" />
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </form>
</div>
